/*
 * jquery-image-explode 1.0.0
 * 
 * https://github.com/blackmiaool/jquery-image-explode#readme
 *
 * Copyright 2015, blackmiaool
 * Released under the MIT license.
*/

"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var a=0,i=Array(t.length);a<t.length;a++)i[a]=t[a];return i}return Array.from(t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};!function(t){var a="explode-wrapper";t.fn.explodeRestore=function(){this.each(function(){var i=t(this),e=i.prop(a);e&&(e.replaceWith(i),i.prop(a,null))})},t.fn.explode=function(i){function e(t){function a(){var n=Date.now(),o=n-i;Z.clearRect(0,0,z,B),U.forEach(function(t){var a;Z.save();var i=t.width,n=t.height;Z.translate(t.biasx,t.biasy),Z.rotate(t.lastAngle||t.finalAngleRad),X&&(Z.beginPath(),Z.arc(0,0,i/2,0,2*Math.PI,!1),Z.closePath(),Z.clip());var r=void 0;r=o<t.time1?1:o>t.time2?0:1-(o-t.time1)/M,0!==r||t.released||(t.released=!0,e--),Z.globalAlpha=r,(a=Z).drawImage.apply(a,[G[0]].concat(_toConsumableArray(t.naturalParams),[-i/2,-n/2,i,n])),Z.restore()}),e?window.requestAnimationFrame(a):t&&t()}var i=Date.now(),e=U.length;U.forEach(function(t){t.time1=1e3/(t.ratio*(L+1-t.width)/L+.1),t.time2=t.time1+M}),a()}function n(){setTimeout(function(){o(function(){G.explodeRestore()},!0)},I)}function o(t,a){function i(){var r=Date.now(),l=void 0,s=void 0;if(l=(r-n)/1e3,s=(r-e)/Y,a&&(s=1-s),S)nt+=S*l*300;else{if(s>1||s<0)return void(t&&t());l*=Math.cos(s*Math.PI/2)*Math.PI/2}a&&(l=-l),n=r,Z.clearRect(0,0,z,B),U.forEach(function(t){var a;Z.save();var i=t.width,e=t.height;t.land||(t.biasx+=t.vx*l,t.biasy+=(t.vy+nt)*l,S&&t.biasy>t.transYMax&&(o--,t.land=!0,t.lastAngle=t.finalAngleRad*s,t.biasy=t.transYMax)),Z.translate(t.biasx,t.biasy),t.lastAngle?Z.rotate(t.lastAngle):Z.rotate(t.finalAngleRad*s),X&&(Z.beginPath(),Z.arc(0,0,i/2,0,2*Math.PI,!1),Z.closePath(),Z.clip()),(a=Z).drawImage.apply(a,[G[0]].concat(_toConsumableArray(t.naturalParams),[-i/2,-e/2,i,e])),Z.restore()}),S&&!o?t():window.requestAnimationFrame(i)}var e=Date.now(),n=e,o=U.length;a||U.forEach(function(t){t.vx=t.translateX/Y*1e3,t.vy=t.translateY/Y*1e3,t.biasx=t.translateX0,t.biasy=t.translateY0,t.transYMax=B/2+j-t.height/2}),i()}function r(t,a){return parseInt(Math.random()*(a+1-t),10)+t}function l(){U.forEach(function(t,a){var i=(Math.random()*_*2-_)/((Math.random()+2)*t.width)*10,e=i*(Math.PI/180),n=t.left+t.width/2-N/2,o=t.top+t.width/2-Q/2;0===n&&(n=a%2?-1:1),0===o&&(o=a%4<2?-1:1);var r=Math.sqrt(n*n+o*o),l=((1-O)*(1-(t.width-c)/(L-c))+O)*Math.random();l=1-(1-l)*(1-g/p);var s=(p-r)*l+r,h=r*r,d=(s-r)*Math.sqrt((h-o*o)/h)*(n>0?1:-1),f=(s-r)*Math.sqrt((h-n*n)/h)*(o>0?1:-1),u=(z-N)/2+t.left+t.width/2,v=(B-Q)/2+t.top+t.height/2,m={finalDistance:s,ratio:l,x:n,y:o,distance:r,translateX:d,translateY:f,translateX0:u,translateY0:v,finalAngleRad:e,finalAngle:i};for(var y in m)t[y]=m[y]})}function s(){function t(t){function a(t){var a=e;if(e+=t,i.push({left:a,top:n,width:t,height:t}),D)for(var o=1;o<parseInt(L/t);o++)i.push({left:a,top:n+o*t,width:t,height:t})}var e=0,n=t*L,o=void 0;do o&&a(o),o=r(c,L);while(N>e+o);N-e>=c&&a(N-e)}var a=void 0;a=u?Math.floor(Q/L):Math.ceil(Q/L);for(var i=[],e=0;e<a;e++)t(e);return i.sort(function(t,a){return Math.random()>.5?1:-1}),i}i&&"object"===("undefined"==typeof i?"undefined":_typeof(i))||(i={});var h=i,d=h.minWidth,c=void 0===d?3:d,f=h.omitLastLine,u=void 0!==f&&f,v=h.radius,p=void 0===v?80:v,m=h.minRadius,g=void 0===m?20:m,y=h.release,w=void 0===y||y,b=h.fadeTime,M=void 0===b?300:b,x=h.recycle,A=void 0===x||x,P=h.recycleDelay,I=void 0===P?500:P,R=h.fill,D=void 0===R||R,E=h.explodeTime,Y=void 0===E?300:E,q=h.maxAngle,_=void 0===q?360:q,C=h.gravity,S=void 0===C?0:C,W=h.round,X=void 0!==W&&W,T=h.groundDistance,j=void 0===T?400:T,F=i,L=F.maxWidth,G=this,H=arguments;G.each(function(){var a=t(this);"IMG"===a.prop("tagName")&&(a.prop("complete")||a.on("load",function(){a.explode.apply(a,H)}))});var N=G.width(),Q=G.height(),k=Math.min(N,Q),z=Math.max(N,2*p),B=Math.max(Q,2*p,2*j);L||(L=k/4);var J=t("<div></div>",{class:a}),K=["width","height","margin-top","margin-right","margin-bottom","margin-left","position","top","right","bottom","left","float","display"];K.forEach(function(t){J.css(t,G.css(t))}),"static"===J.css("position")&&J.css("position","relative");var O=.3,U=s();l();var V=void 0,Z=void 0,$=G[0],tt=$.naturalWidth,at=$.naturalHeight;V=t("<canvas></canvas>"),V.css({position:"absolute",left:(N-z)/2,right:(N-z)/2,top:(Q-B)/2,bottom:(Q-B)/2,margin:"auto",width:z,height:B}),V.attr({width:z,height:B}),J.append(V);var it=N/tt,et=Q/at;U.forEach(function(t){var a=t.left,i=t.top,e=t.width,n=t.height;Z=V[0].getContext("2d"),t.naturalParams=[a/it,i/et,e/it,n/et]}),G.after(J),G.prop(a,J),G.detach();var nt=0;o(function(){w?e():A&&n()})}}(window.jQuery);